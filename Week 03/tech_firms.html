<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data wrangling with tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="tech_firms_files/libs/clipboard/clipboard.min.js"></script>
<script src="tech_firms_files/libs/quarto-html/quarto.js"></script>
<script src="tech_firms_files/libs/quarto-html/popper.min.js"></script>
<script src="tech_firms_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="tech_firms_files/libs/quarto-html/anchor.min.js"></script>
<link href="tech_firms_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="tech_firms_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="tech_firms_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="tech_firms_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="tech_firms_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data wrangling with <code>tidyverse</code></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>Important</strong></p>
<p>If you haven’t installed <code>tidyverse</code> package before, do this:</p>
<p>Install <code>tidyverse</code> package by running the following command in the console. This needs to be done only once so make sure that you don’t run it from your Rmarkdown code chunk.</p>
<p>install.packages(“tidyverse”)</p>
<p>Once the installation is complete, load the library</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will also use a utility library called <code>here</code> which helps us locating files in the project folder. Locating files is not an issue when your project directory has no subdirectories. However, that’s unlikely. For example, in my case, I stored the data files in a subdirectory called “Data”. <code>here</code> package makes it easy to reference that subdirectory and the dataset stored within.</p>
<p>Install <code>here</code> package by running <code>install.packages("here")</code> from your console.</p>
<section id="data-manipulation" class="level2">
<h2 class="anchored" data-anchor-id="data-manipulation">Data manipulation</h2>
<p>Read the zipped CSV file. Note how I have labeled the code chunk as “data-read”. This way I can later easily reference the code chunk if required.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"Data"</span>, <span class="st">"tech_stocks_csv.zip"</span>),</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="co"># I add this argument to silent the output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="frequency-distribution" class="level3">
<h3 class="anchored" data-anchor-id="frequency-distribution">Frequency distribution</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(dt, fyear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 2
   fyear     n
   &lt;dbl&gt; &lt;int&gt;
 1  2009     1
 2  2010     7
 3  2011     7
 4  2012     7
 5  2013     7
 6  2014     7
 7  2015     7
 8  2016     7
 9  2017     7
10  2018     7
11  2019     7
12  2020     7
13  2021     7
14  2022     7
15  2023     1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dt, conm, fyear),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  fyear <span class="sc">==</span> <span class="dv">2009</span> <span class="sc">|</span> fyear <span class="sc">==</span> <span class="dv">2023</span> <span class="co">#De Morgans Law = !(fyear &gt; 2009 &amp; fyear &lt; 2023)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  conm           fyear
  &lt;chr&gt;          &lt;dbl&gt;
1 MICROSOFT CORP  2023
2 NVIDIA CORP     2009</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(dt, conm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  conm                   n
  &lt;chr&gt;              &lt;int&gt;
1 ALPHABET INC          13
2 AMAZON.COM INC        13
3 APPLE INC             13
4 META PLATFORMS INC    13
5 MICROSOFT CORP        14
6 NVIDIA CORP           14
7 TESLA INC             13</code></pre>
</div>
</div>
</section>
<section id="select-columns" class="level3">
<h3 class="anchored" data-anchor-id="select-columns">Select columns</h3>
<p>Use <code>select()</code> function from <code>dplyr</code> package to select columns</p>
<p>In the following example, we will select a handful of columns and then save the resulting dataframe into <code>dt1</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">.data =</span> dt, conm, fyear, sale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Print dt1</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dt1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 93 × 3
   conm      fyear   sale
   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;
 1 APPLE INC  2010  65225
 2 APPLE INC  2011 108249
 3 APPLE INC  2012 156508
 4 APPLE INC  2013 170910
 5 APPLE INC  2014 182795
 6 APPLE INC  2015 233715
 7 APPLE INC  2016 215091
 8 APPLE INC  2017 229234
 9 APPLE INC  2018 265359
10 APPLE INC  2019 260174
# ℹ 83 more rows</code></pre>
</div>
</div>
</section>
<section id="creating-a-new-variable" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-new-variable">Creating a new variable</h3>
<p><code>mutate()</code> function from <code>dplyr</code> allows you to create new variables</p>
<p>The variable <code>sale</code> is in million USD. Let’s create a new variable <code>sale_bil</code> which stores sales in billion USD.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(dt1, <span class="at">sale_bil =</span> sale <span class="sc">/</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 93 × 4
   conm      fyear   sale sale_bil
   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
 1 APPLE INC  2010  65225     65.2
 2 APPLE INC  2011 108249    108. 
 3 APPLE INC  2012 156508    157. 
 4 APPLE INC  2013 170910    171. 
 5 APPLE INC  2014 182795    183. 
 6 APPLE INC  2015 233715    234. 
 7 APPLE INC  2016 215091    215. 
 8 APPLE INC  2017 229234    229. 
 9 APPLE INC  2018 265359    265. 
10 APPLE INC  2019 260174    260. 
# ℹ 83 more rows</code></pre>
</div>
</div>
<p>Create multiple variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(dt1,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">sale_bil =</span> sale <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">sale_sq =</span> <span class="fu">round</span>(sale_bil<span class="sc">^</span><span class="dv">2</span>, <span class="dv">2</span>), <span class="co"># Create square of sales and round it to 2 decimals</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">log_sale =</span> <span class="fu">log</span>(sale))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 93 × 6
   conm      fyear   sale sale_bil sale_sq log_sale
   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
 1 APPLE INC  2010  65225     65.2   4254.     11.1
 2 APPLE INC  2011 108249    108.   11718.     11.6
 3 APPLE INC  2012 156508    157.   24495.     12.0
 4 APPLE INC  2013 170910    171.   29210.     12.0
 5 APPLE INC  2014 182795    183.   33414.     12.1
 6 APPLE INC  2015 233715    234.   54623.     12.4
 7 APPLE INC  2016 215091    215.   46264.     12.3
 8 APPLE INC  2017 229234    229.   52548.     12.3
 9 APPLE INC  2018 265359    265.   70415.     12.5
10 APPLE INC  2019 260174    260.   67691.     12.5
# ℹ 83 more rows</code></pre>
</div>
</div>
</section>
<section id="summarize-data" class="level3">
<h3 class="anchored" data-anchor-id="summarize-data">Summarize data</h3>
<p>Base R has <code>summary()</code> function that provide basic summary of the variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dt1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     conm               fyear           sale         
 Length:93          Min.   :2009   Min.   :   116.7  
 Class :character   1st Qu.:2013   1st Qu.: 12466.0  
 Mode  :character   Median :2016   Median : 70697.0  
                    Mean   :2016   Mean   :103392.0  
                    3rd Qu.:2019   3rd Qu.:156508.0  
                    Max.   :2023   Max.   :513983.0  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">summary</span>(dt1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "table"</code></pre>
</div>
</div>
<p><code>summarize()</code> function from <code>dplyr</code> helps in getting summaries as a dataframe.</p>
<p>Use <code>dt</code> to get averages of sales, total assets, profits, and advertising</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(dt,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">sale_mean =</span> <span class="fu">mean</span>(sale),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">at_mean =</span> <span class="fu">mean</span>(at),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">oibdp_mean =</span> <span class="fu">mean</span>(oibdp),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">xad_mean =</span> <span class="fu">mean</span>(xad))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  sale_mean at_mean oibdp_mean xad_mean
      &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1   103392. 138297.     28792.       NA</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(dt, xad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 93 × 1
     xad
   &lt;dbl&gt;
 1   691
 2   933
 3  1000
 4  1100
 5  1200
 6  1800
 7    NA
 8    NA
 9    NA
10    NA
# ℹ 83 more rows</code></pre>
</div>
</div>
<p>We get a missing value in return for <code>xad_mean</code>. This is because by default <code>mean()</code> requires non-missing values. We can remove the <code>NA</code> from <code>xad</code> before taking the mean by using <code>na.rm</code> argument inside <code>mean()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(dt,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">sale_mean =</span> <span class="fu">mean</span>(sale),</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">at_mean =</span> <span class="fu">mean</span>(at),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">oibdp_mean =</span> <span class="fu">mean</span>(oibdp),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">xad_mean =</span> <span class="fu">mean</span>(xad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  sale_mean at_mean oibdp_mean xad_mean
      &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1   103392. 138297.     28792.    2423.</code></pre>
</div>
</div>
<p>Using <code>across()</code>function to apply a function to multiple columns in <code>summarize()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(dt,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">across</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(sale, at, oibdp, xad), mean</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>) <span class="co">#xad is still NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
     sale      at  oibdp   xad
    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 103392. 138297. 28792.    NA</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(dt,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">across</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(sale, at, oibdp, xad), \(x) <span class="fu">mean</span>(x, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="co">#lambda function from python, `x` must match</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>            , <span class="at">.names =</span> <span class="st">"{.col}_mean"</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  sale_mean at_mean oibdp_mean xad_mean
      &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1   103392. 138297.     28792.    2423.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(dt,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">across</span>(<span class="fu">c</span>(sale, at, oibdp, xad)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                 , <span class="fu">list</span>( <span class="at">mean =</span> \(x) <span class="fu">mean</span>(x, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                         , <span class="at">sd =</span> \(y) <span class="fu">sd</span>(y, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                    ) </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                 , <span class="at">.names =</span> <span class="st">"{.col}_{.fn}"</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  sale_mean sale_sd at_mean   at_sd oibdp_mean oibdp_sd xad_mean xad_sd
      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
1   103392. 111833. 138297. 129903.     28792.   30862.    2423.  3673.</code></pre>
</div>
</div>
</section>
<section id="summaries-by-groups." class="level3">
<h3 class="anchored" data-anchor-id="summaries-by-groups.">Summaries by groups.</h3>
<p>Next, We want to find the averages of the above variables for each company separately. For this we can use <code>group_by()</code> function from <code>dplyr</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dt_grouped <span class="ot">=</span> <span class="fu">group_by</span>(dt, conm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(<span class="fu">group_by</span>(dt, conm), <span class="co"># Note how I used group_by</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">sale_mean =</span> <span class="fu">mean</span>(sale),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">at_mean =</span> <span class="fu">mean</span>(at),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">oibdp_mean =</span> <span class="fu">mean</span>(oibdp),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">xad_mean =</span> <span class="fu">mean</span>(xad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  conm               sale_mean at_mean oibdp_mean xad_mean
  &lt;chr&gt;                  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1 ALPHABET INC         118540. 194721.     38211.   4489. 
2 AMAZON.COM INC       200842. 157213.     17319.   7130  
3 APPLE INC            224763. 271217.     71469.   1121. 
4 META PLATFORMS INC    43413   78703.     20111.    911. 
5 MICROSOFT CORP       114056. 228515.     49124.   1693. 
6 NVIDIA CORP            9914.  14837.      3053.     15.1
7 TESLA INC             18585.  25427.      2673.     33.8</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(dt, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">sale_mean =</span> <span class="fu">mean</span>(sale),</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">at_mean =</span> <span class="fu">mean</span>(at),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">oibdp_mean =</span> <span class="fu">mean</span>(oibdp),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">xad_mean =</span> <span class="fu">mean</span>(xad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">.by =</span> conm <span class="co">#Experimental</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  conm               sale_mean at_mean oibdp_mean xad_mean
  &lt;chr&gt;                  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1 APPLE INC            224763. 271217.     71469.   1121. 
2 MICROSOFT CORP       114056. 228515.     49124.   1693. 
3 AMAZON.COM INC       200842. 157213.     17319.   7130  
4 NVIDIA CORP            9914.  14837.      3053.     15.1
5 ALPHABET INC         118540. 194721.     38211.   4489. 
6 META PLATFORMS INC    43413   78703.     20111.    911. 
7 TESLA INC             18585.  25427.      2673.     33.8</code></pre>
</div>
</div>
</section>
</section>
<section id="pipes" class="level2">
<h2 class="anchored" data-anchor-id="pipes">Pipes</h2>
<p>This is where I would like to introduce the concept of pipes. Consider two steps to create a subset of <code>dt</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">=</span> <span class="fu">select</span>(dt, conm, fyear, sale)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">=</span> <span class="fu">filter</span>(dt1, sale <span class="sc">&gt;</span> <span class="dv">100000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">=</span> <span class="fu">filter</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dt, conm, fyear, sale),</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  sale <span class="sc">&gt;</span> <span class="dv">100000</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These two steps can be combined into one step. Can you think of any reasons for why this is useful?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">=</span> dt <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">.data =</span> ., conm, fyear, sale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">=</span> dt <span class="sc">%&gt;%</span> <span class="fu">select</span>(conm , fyear, sale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">=</span> dt <span class="sc">%&gt;%</span> <span class="fu">select</span>(conm , fyear, sale) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sale <span class="sc">&gt;</span> <span class="dv">100000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From https://www.techopedia.com/definition/3410/pipe</p>
<p><em>A pipe is a method used to pass information from one program process to another. Unlike other types of interprocess communication, a pipe only offers one-way communication by passing a parameter or output from one process to another. The information that is passed through the pipe is held by the system until it can be read by the receiving process. Pipes are primarily used in programming on Unix systems.</em></p>
<p>We will use <code>%&gt;%</code> to pipe output data from one <code>tidyverse</code> function to the next. This pipe originates from <code>magrittr</code> package. Read more about it here: https://magrittr.tidyverse.org/reference/pipe.html</p>
<p>Native pip in R <code>|&gt;</code> ~ but its missing some functionality</p>
<p>The keyboard shortcut is</p>
<p>Shift + Command + M (Mac) Shift + Control + M (Windows)</p>
<p>As an example, we will select a few variables and then pass them on to summarize using a pipe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">.data =</span> ., </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>         conm, fyear, sale, at, oibdp, xad) <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">.data =</span> .,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sale_mean =</span> <span class="fu">mean</span>(sale),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">at_mean =</span> <span class="fu">mean</span>(at),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">oibdp_mean =</span> <span class="fu">mean</span>(oibdp),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">xad_mean =</span> <span class="fu">mean</span>(xad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  sale_mean at_mean oibdp_mean xad_mean
      &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1   103392. 138297.     28792.    2423.</code></pre>
</div>
</div>
<p>Can you create grouped means for each company?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">.data =</span> ., </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>         conm, fyear, sale, at, oibdp, xad) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">.data =</span> ., conm) <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">.data =</span> .,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">sale_mean =</span> <span class="fu">mean</span>(sale),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">at_mean =</span> <span class="fu">mean</span>(at),</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">oibdp_mean =</span> <span class="fu">mean</span>(oibdp),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">xad_mean =</span> <span class="fu">mean</span>(xad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  conm               sale_mean at_mean oibdp_mean xad_mean
  &lt;chr&gt;                  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1 ALPHABET INC         118540. 194721.     38211.   4489. 
2 AMAZON.COM INC       200842. 157213.     17319.   7130  
3 APPLE INC            224763. 271217.     71469.   1121. 
4 META PLATFORMS INC    43413   78703.     20111.    911. 
5 MICROSOFT CORP       114056. 228515.     49124.   1693. 
6 NVIDIA CORP            9914.  14837.      3053.     15.1
7 TESLA INC             18585.  25427.      2673.     33.8</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(conm, fyear, sale, at, oibdp, xad) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(conm) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sale_mean =</span> <span class="fu">mean</span>(sale),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">at_mean =</span> <span class="fu">mean</span>(at),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">oibdp_mean =</span> <span class="fu">mean</span>(oibdp),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">xad_mean =</span> <span class="fu">mean</span>(xad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  conm               sale_mean at_mean oibdp_mean xad_mean
  &lt;chr&gt;                  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1 ALPHABET INC         118540. 194721.     38211.   4489. 
2 AMAZON.COM INC       200842. 157213.     17319.   7130  
3 APPLE INC            224763. 271217.     71469.   1121. 
4 META PLATFORMS INC    43413   78703.     20111.    911. 
5 MICROSOFT CORP       114056. 228515.     49124.   1693. 
6 NVIDIA CORP            9914.  14837.      3053.     15.1
7 TESLA INC             18585.  25427.      2673.     33.8</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(conm, fyear, sale, at, oibdp,xad) <span class="sc">%&gt;%</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(conm) <span class="sc">%&gt;%</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(sale, at, oibdp, xad), \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  conm                  sale      at  oibdp    xad
  &lt;chr&gt;                &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 ALPHABET INC       118540. 194721. 38211. 4489. 
2 AMAZON.COM INC     200842. 157213. 17319. 7130  
3 APPLE INC          224763. 271217. 71469. 1121. 
4 META PLATFORMS INC  43413   78703. 20111.  911. 
5 MICROSOFT CORP     114056. 228515. 49124. 1693. 
6 NVIDIA CORP          9914.  14837.  3053.   15.1
7 TESLA INC           18585.  25427.  2673.   33.8</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(conm, fyear, sale, at, oibdp, xad) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(conm) <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(sale, at, oibdp, xad)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>      ,<span class="fu">list</span>( </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean =</span> \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">sd =</span> \(y) <span class="fu">sd</span>(y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>      ), <span class="at">.names =</span> <span class="st">"{.col}_{.fn}"</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 9
  conm      sale_mean sale_sd at_mean  at_sd oibdp_mean oibdp_sd xad_mean xad_sd
  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
1 ALPHABET…   118540.  82029. 194721. 1.07e5     38211.   26837.   4489.  2.55e3
2 AMAZON.C…   200842. 164507. 157213. 1.54e5     17319.   16551.   7130   6.18e3
3 APPLE INC   224763.  92452. 271217. 1.00e5     71469.   29125.   1121.  3.75e2
4 META PLA…    43413   42337.  78703. 6.47e4     20111.   18343.    911.  1.09e3
5 MICROSOF…   114056.  48604. 228515. 1.01e5     49124.   27125.   1693.  3.98e2
6 NVIDIA C…     9914.   8203.  14837. 1.35e4      3053.    3162.     15.1 5.07e0
7 TESLA INC    18585.  24698.  25427. 2.65e4      2673.    5266.     33.8 2.76e1</code></pre>
</div>
</div>
<p>When will the pip fail?</p>
<p>Case 1. When the object on the left does not match the required object to the function on tight</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(conm, fyear, sale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in UseMethod("select"): no applicable method for 'select' applied to an object of class "character"</code></pre>
</div>
</div>
<p>Case 2. When the object on left is passed to incorrect argument of the function on right</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(<span class="at">formula =</span>  sale <span class="sc">~</span> at <span class="sc">+</span> cogs, <span class="at">data =</span> dt))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sale ~ at + cogs, data = dt)

Residuals:
   Min     1Q Median     3Q    Max 
-55750  -4630   -566   4040  44332 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 3.796e+02  2.434e+03   0.156    0.876    
at          3.341e-01  1.996e-02  16.745   &lt;2e-16 ***
cogs        1.209e+00  4.241e-02  28.510   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 16000 on 90 degrees of freedom
Multiple R-squared:   0.98, Adjusted R-squared:  0.9795 
F-statistic:  2201 on 2 and 90 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(sale <span class="sc">~</span> at <span class="sc">+</span> cogs) <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in as.data.frame.default(data): cannot coerce class '"formula"' to a data.frame</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(sale <span class="sc">~</span> at <span class="sc">+</span> cogs, <span class="at">data =</span>.) <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sale ~ at + cogs, data = .)

Residuals:
   Min     1Q Median     3Q    Max 
-55750  -4630   -566   4040  44332 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 3.796e+02  2.434e+03   0.156    0.876    
at          3.341e-01  1.996e-02  16.745   &lt;2e-16 ***
cogs        1.209e+00  4.241e-02  28.510   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 16000 on 90 degrees of freedom
Multiple R-squared:   0.98, Adjusted R-squared:  0.9795 
F-statistic:  2201 on 2 and 90 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<section id="joining-dataframes" class="level3">
<h3 class="anchored" data-anchor-id="joining-dataframes">Joining dataframes</h3>
<p><code>dplyr</code> provides several <code>_join</code> functions inspired by SQL.<br>
</p>
<p>https://learnsql.com/blog/learn-and-practice-sql-joins/</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="joins.png" class="img-fluid"></p>
</div>
</div>
<p>We will create summary of sales by fyear and join it to dt1</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>dt1_summary <span class="ot">=</span> dt1 <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fyear) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sale_mean =</span> <span class="fu">mean</span>(sale))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>dt1_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 2
   fyear sale_mean
   &lt;dbl&gt;     &lt;dbl&gt;
 1  2009     3326.
 2  2010    28124.
 3  2011    38870.
 4  2012    50183.
 5  2013    56722.
 6  2014    63512.
 7  2015    76611.
 8  2016    81174.
 9  2017    95719.
10  2018   119206.
11  2019   133513.
12  2020   160042.
13  2021   208576.
14  2022   230637.
15  2023   211915 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">=</span> <span class="fu">inner_join</span>(dt1, dt1_summary, <span class="at">by =</span> <span class="st">"fyear"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>dt2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 93 × 4
   conm      fyear   sale sale_mean
   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
 1 APPLE INC  2010  65225    28124.
 2 APPLE INC  2011 108249    38870.
 3 APPLE INC  2012 156508    50183.
 4 APPLE INC  2013 170910    56722.
 5 APPLE INC  2014 182795    63512.
 6 APPLE INC  2015 233715    76611.
 7 APPLE INC  2016 215091    81174.
 8 APPLE INC  2017 229234    95719.
 9 APPLE INC  2018 265359   119206.
10 APPLE INC  2019 260174   133513.
# ℹ 83 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fyear) <span class="sc">%&gt;%</span> </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sale_mean =</span> <span class="fu">mean</span>(sale),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">sale_ratio =</span> scales<span class="sc">::</span><span class="fu">percent</span>(sale <span class="sc">/</span> sale_mean, <span class="at">accuracy =</span> <span class="fl">0.01</span>),</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">sale =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(sale),</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">sale_mean =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(sale_mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 93 × 5
# Groups:   fyear [15]
   conm      fyear sale       sale_mean  sale_ratio
   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
 1 APPLE INC  2010 $65,225.00 $28,124.01 231.92%   
 2 APPLE INC  2011 $108,249   $38,869.60 278.49%   
 3 APPLE INC  2012 $156,508   $50,183.06 311.87%   
 4 APPLE INC  2013 $170,910   $56,721.67 301.31%   
 5 APPLE INC  2014 $182,795   $63,511.55 287.81%   
 6 APPLE INC  2015 $233,715   $76,610.58 305.07%   
 7 APPLE INC  2016 $215,091   $81,174.02 264.98%   
 8 APPLE INC  2017 $229,234   $95,718.68 239.49%   
 9 APPLE INC  2018 $265,359   $119,206   222.61%   
10 APPLE INC  2019 $260,174   $133,513   194.87%   
# ℹ 83 more rows</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>